:ogp_title: Pythonã®ãƒªãƒ³ã‚¿ã‚’ä½œã‚ã†
:ogp_event_name: pyconshizu
:ogp_slide_name: write-linter-rules
:ogp_description: PyCon mini Shizuoka 2026
:ogp_image_name: pyconshizu

==================================================
Pythonã®ãƒªãƒ³ã‚¿ã‚’ä½œã‚ã†
==================================================

:Event: PyCon mini Shizuoka 2026
:Presented: 2026/02/21 nikkie

è¨‚æ­£ï¼šãƒªãƒ³ã‚¿ã® **ãƒ«ãƒ¼ãƒ«** ã‚’ä½œã‚ã†
==================================================

* ãƒ—ãƒ­ãƒãƒ¼ã‚¶ãƒ«ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒæœ¬æ–‡ã‚’åæ˜ ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚ã”ã‚ã‚“ãªã•ã„ [#build-python-linter-first-step]_
* ä¸»å¼µï¼šPythonã®ãƒªãƒ³ã‚¿ã® **ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã‘ã‚‹** ã‚ˆã†ã«ãªã£ã¦ã€ã‚ˆã‚Šä½¿ã„ã“ãªã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼ˆ:fab:`github` `ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ <https://github.com/ftnext/2026-slides/tree/main/samplecode/write-python-linter-rules>`__ï¼‰

.. [#build-python-linter-first-step] ã›ã‚ã¦ã‚‚ã®ãŠè©«ã³ã¨ã—ã¦æ‹™ãƒ–ãƒ­ã‚° `flake8 ã‚’è¦³å¯Ÿã—ã¦ä½œã‚‹ã€å°ã•ãª Python ãƒªãƒ³ã‚¿ï¼ˆä¸€æ­©ç›®ï¼‰  <https://nikkie-ftnext.hatenablog.com/entry/my-first-python-linter-based-on-flake8-observation-first-step>`__

çš†ã•ã¾ãŠä½¿ã„ã®ãƒªãƒ³ã‚¿ã¯ï¼Ÿ
--------------------------------------------------

* Ruff
* flake8
* pylint

å¯¾è±¡ï¼šä»•çµ„ã¿ã¯åˆ†ã‹ã‚‰ãªã„ãŒã€1ã¤ã§ã‚‚ **å‹•ã‹ã—ãŸã“ã¨ãŒã‚ã‚‹**

ãŠå‰ã€èª°ã‚ˆ
==================================================

* nikkieï¼ˆã«ã£ããƒ¼ï¼‰ãƒ»Pythonæ­´8å¹´ãƒ»`ãƒ–ãƒ­ã‚° <https://nikkie-ftnext.hatenablog.com/>`__ é€£ç¶š1100æ—¥çªç ´
* æ©Ÿæ¢°å­¦ç¿’ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€‚ `Speeda AI Agent <https://jp.ub-speeda.com/news/speeda-promotion-gallery/>`__ é–‹ç™ºï¼ˆ`We're hiring! <https://hrmos.co/pages/uzabase/jobs/1829077236709650481>`__ï¼‰

.. image:: ../_static/uzabase-white-logo.png

.. _flake8-kotoha: https://pypi.org/project/flake8-kotoha/

**æ‹¡å¼µ** ã§ãã‚‹ã‚‚ã®ãŒå¥½ã
--------------------------------------------------

* å…¬é–‹ã—ã¦ã„ã‚‹ flake8 ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ :fab:`github` `@ftnext <https://github.com/ftnext>`__

  * `flake8-kotoha`_
  * `happy-python-logging <https://pypi.org/project/happy-python-logging/>`__

* Ruff ä½¿ã£ã¦ã¾ã™ï¼ˆé€Ÿã• & ç°¡å˜ã•ï¼‰

å°å…¥ï¼šã‚ãªãŸã¯ãƒªãƒ³ã‚¿ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ããŸããªã‚‹
==================================================

.. _PEP 8: https://peps.python.org/pep-0008/

ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ `PEP 8`_
--------------------------------------------------

* è¦‹ãŸç›®ã«ã¤ã„ã¦ï¼ˆä¾‹ï¼šæ¼”ç®—å­ã¨åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ [#formatter]_
* ã“ã®ã‚ˆã†ãªPythonã‚’ **æ›¸ã„ã¦ã¯ã„ã‘ã¾ã›ã‚“** ï¼ˆä»£ã‚ã‚Šã«ã“ã†æ›¸ãã¾ã—ã‚‡ã†ï¼‰

    * ã“ã®ãƒˆãƒ¼ã‚¯ã§ãƒªãƒ³ã‚¿ãŒæŒ‡ã—ã¦ã„ã‚‹ã®ã¯ã“ã¡ã‚‰

.. [#formatter] ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¨å‘¼ã°ã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã®å‡ºç•ªã§ã™ã­

ä¾‹ã€Œã“ã®ã‚ˆã†ã«æ›¸ã„ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ [#B012]_
--------------------------------------------------

.. code-block:: python
    :caption: ã¶ã£ã¶ãƒ¼ã§ã™ã‚ğŸ™…â€â™€ï¸

    def foo():
        try:
            1 / 0
        finally:
            return 42

.. [#B012] `jump-statement-in-finally (B012) <https://docs.astral.sh/ruff/rules/jump-statement-in-finally/>`__ ï¼ˆæ‹™ãƒ–ãƒ­ã‚° `ã€ŒWhat's new in Python 3.14ã€ã‚ˆã‚Š finally ç¯€ã§ã® returnï¼ˆã‚„ continueãƒ»breakï¼‰ã¯ SyntaxWarning ã§è­¦å‘Šã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼ˆPEP 765ï¼‰ <https://nikkie-ftnext.hatenablog.com/entry/whatsnew-python-314-pep-765-syntaxwarning-finally-return>`__ï¼‰

PEP 8 ä»¥å¤–ã®ä¾‹ï¼šãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«f-stringã¯ã„ã‘ã¾ã›ã‚“ [#G004]_
----------------------------------------------------------------------

.. code-block:: python
    :caption: ã¶ã£ã¶ãƒ¼ã§ã™ã‚ğŸ™…â€â™€ï¸

    logger.info(f"{user} - Something happened")

.. code-block:: python
    :caption: ãƒ­ã‚®ãƒ³ã‚°ã§ã¯ **%æ¼”ç®—å­ã«ã‚ˆã‚‹æ›¸å¼åŒ–**

    logger.info("%s - Something happened", user)

.. ï¼ˆãƒ­ã‚®ãƒ³ã‚°ã£ã¦ä¸­ã§%ã—ã¦ã‚‹ã®ã‹ï¼ï¼‰

.. [#G004] `logging-f-string (G004) <https://docs.astral.sh/ruff/rules/logging-f-string/>`__ ï¼ˆæ‹™ãƒ–ãƒ­ã‚° `Pythonã®ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«f-stringã¯ã„ã‘ã¾ã›ã‚“ã€‚ãã“ã®Claudeã€ç§ã¯ã‚ãªãŸã«è¨€ã£ã¦ã„ã‚‹ã‚“ã§ã™ã‚ˆ <https://nikkie-ftnext.hatenablog.com/entry/hey-claude-dont-use-f-string-in-logging-messages>`__ï¼‰

ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã¯ãƒªãƒ³ã‚¿ã«ãƒã‚§ãƒƒã‚¯ã•ã›ã‚ˆã†
--------------------------------------------------

* äººé–“ã¯å…¨ã¦ã®ãƒ«ãƒ¼ãƒ«ã‚’è¦šãˆã¦ã„ã‚‰ã‚Œãªã„
* æ›¸ã„ã¦ã¯ã„ã‘ãªã„Pythonã® **æŒ‡æ‘˜ã‚’ãƒªãƒ³ã‚¿ã«ä»»ã›ã‚‹**
* åŠ¹èƒ½ï¼šã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ç„¦ç‚¹ãŒã‚¹ã‚¿ã‚¤ãƒ«ã‹ã‚‰æœ¬è³ªçš„ãªãƒ­ã‚¸ãƒƒã‚¯ã¸

.. äººé–“ãŒå‹‰å¼·ã®ãŸã‚ã«ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã™ã‚‹ã®ã¯å¤§äº‹
    https://nikkie-ftnext.hatenablog.com/entry/write-python-following-pep8-opportunity-to-understand#%E6%80%9D%E3%81%88%E3%81%B0Flake8%E3%81%AB%E5%8F%B1%E3%81%A3%E3%81%A6%E3%82%82%E3%82%89%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒªãƒ³ã‚¿ã‚’æŒãŸã›ã‚‹
--------------------------------------------------

* IMOï¼šLLMã¯ï¼ˆæ€§èƒ½å‘ä¸Šã¯ç”šã ã—ã„ãŒï¼‰Pythonã‚’ååˆ†ã«ã¯ç†è§£ã—ã¦ã„ãªã„

    * ä¾‹ï¼šå…ˆã®ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®f-string

* **ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã§ãƒªãƒ³ã‚¿ã‚’çµ„ã¿è¾¼ã¿** ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã‚’å¼·åˆ¶ã™ã‚‹ [#yapc-fukuoka-lt]_

.. [#yapc-fukuoka-lt] YAPCã§ã®LTğŸ… `Pythonã‚’"ç†è§£"ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ¬²ã—ã„ï¼ï¼ <https://ftnext.github.io/2025-slides/yapc-fukuoka/lt-agent-who-understand-python.html#/2>`__

ã€ŒæŒ‡æ‘˜ã—ãŸã„ãƒ«ãƒ¼ãƒ«ãŒèª°ã«ã‚‚å…¬é–‹ã•ã‚Œã¦ã„ãªã„ã€å•é¡Œ
------------------------------------------------

* ãƒªãƒ³ãƒˆãƒ«ãƒ¼ãƒ«ã¯ 800 ä»¥ä¸Šã‚ã‚‹ãŒã€è‡ªåˆ†ãŒæ¬²ã—ã„ãƒ«ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ãªã„ã“ã¨ãŒã‚ã‚‹

.. code-block:: python
    :caption: ã“ã®å‹ãƒ’ãƒ³ãƒˆã«ã¯ä¼¸ã³ã—ã‚ãŒã‚ã‚‹

    def plus_one_ng(numbers: list[int]) -> list[int]:
        return [n + 1 for n in numbers]

.. _typing.List: https://docs.python.org/ja/3/library/typing.html#typing.List

å¼•æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚’listã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“
--------------------------------------------------

.. code-block:: python
    :caption: listä»¥å¤–ã‚’æ¸¡ã—ã¦ã‚‚å‹•ãã¾ã™

    plus_one_ng((1, 2, 3))  # collections.abc.Sequence
    plus_one_ng(range(3))   # collections.abc.Iterable

`typing.List`_ ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Š
--------------------------------------------------

    Note that to annotate arguments, it is preferred to use an abstract collection type such as ``Sequence`` or ``Iterable`` rather than to use ``list`` or ``typing.List``.

``collections.abc.Sequence`` ã‚„ ``collections.abc.Iterable`` ãªã©ã® **æŠ½è±¡** å‹ãŒå¥½ã¾ã—ã„

`flake8-kotoha`_ ã‚’è‡ªä½œã—ã¾ã—ãŸ
--------------------------------------------------

.. code-block:: console

    $ uvx --with flake8-kotoha flake8 lint-targets/use_iterable.py
    lint-targets/use_iterable.py:6:17: KTH101 Type hint with abstract type `collections.abc.Iterable` or `collections.abc.Sequence`, instead of concrete type `list`

.. code-block:: python
    :caption: ã“ã†ã—ã¾ã—ã‚‡ã†

    def plus_one_ok(numbers: Iterable[int]) -> list[int]:
        return [n + 1 for n in numbers]

ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ããŸããªã£ã¦ãã¾ã—ãŸã‚ˆã­ï¼Ÿ
--------------------------------------------------

ã€Œå¼•æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚’listã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ã‚’ä¾‹ã«

:1. Pythonã§æ›¸ã: ä¾‹ã¨ã—ã¦ **flake8ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**
:2. Ruff ã§ã¯ï¼Ÿ: **æ„è¦‹** ã‚’ä¼ãˆã‚‹ã®ã§è€ƒãˆã‚‹ãã£ã‹ã‘ã«

ãƒªãƒ³ã‚¿ã®ãƒ«ãƒ¼ãƒ«ã‚’Pythonã§æ›¸ã
=======================================

ãã®ãŸã‚ã«ã¾ãš2ã¤æŠ¼ã•ãˆã¾ã—ã‚‡ã†

* æŠ½è±¡æ§‹æ–‡æœ¨ï¼ˆ*AST*: Abstract Syntax Treeï¼‰
* GoF ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã® *Visitor*

ã€Œã“ã®ã‚ˆã†ã«æ›¸ã„ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ã®å®Ÿè£…
--------------------------------------------------

* ã€Œæ›¸ã„ã¦ã¯ã„ã‘ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’ASTã§ **è¡¨ç¾**
* ãã‚Œã‚’ Visitor ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ **è¦‹ã¤ã‘ã‚‹**

.. _Lint Night #1: https://www.youtube.com/watch?v=gKCB6rQxFBU

ãŠã™ã™ã‚ï¼šLintã‚ªã‚¿ã‚¯ã«ã‚ˆã‚‹Lintè§£èª¬ï¼ˆ`Lint Night #1`_ï¼‰ ğŸƒâ€â™‚ï¸
------------------------------------------------------------

.. raw:: html

    <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/ffeacc49800f47a29172d5d11eecc210" title="Lintã‚ªã‚¿ã‚¯ã«ã‚ˆã‚‹Lintè§£èª¬ / Introduction to Lints" allowfullscreen="true" data-ratio="1.7777777777777777"></iframe>

æº–å‚™1ï¸âƒ£ AST
==================================================

* ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ **æœ¨æ§‹é€ ** ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¡¨ç¾ã—ãŸã‚‚ã®
* ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«åˆ†ã‘ã‚‹ [#python-lexical-analysis]_
* ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ§‹æ–‡ã‚’è¡¨ã™æ§‹é€ ï¼ˆæœ¨ï¼‰ã«å¤‰æ›ã™ã‚‹

.. [#python-lexical-analysis] å­—å¥è§£æ https://docs.python.org/ja/3/reference/lexical_analysis.html

.. https://scrapbox.io/nikkie-memos/%E6%A7%8B%E6%96%87%E8%A7%A3%E6%9E%90%EF%BC%88%E3%80%8E%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E7%90%86%E8%AB%96%E3%81%A8%E5%AE%9F%E8%A3%85%E3%80%8F%EF%BC%89

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® ``ast`` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« [#ast-m]_
--------------------------------------------------

.. code-block::

    $ echo 'print("é™å²¡")' | python -m ast
    Module(
       body=[
          Expr(
             value=Call(
                func=Name(id='print', ctx=Load()),
                args=[
                   Constant(value='é™å²¡')]))])

.. [#ast-m] https://docs.python.org/ja/3/library/ast.html#command-line-usage

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ASTã«å¤‰æ› [#ast.parse]_ ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: pycon

    >>> import ast
    >>> tree = ast.parse('print("é™å²¡")')

.. [#ast.parse] https://docs.python.org/ja/3/library/ast.html#ast.parse

ASTã‚’è¡¨ç¤º [#ast.dump]_ ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: pycon

    >>> print(ast.dump(tree, indent=3))
    Module(
       body=[
          Expr(
             value=Call(
                func=Name(id='print', ctx=Load()),
                args=[
                   Constant(value='é™å²¡')]))])

.. [#ast.dump] https://docs.python.org/ja/3/library/ast.html#ast.dump

``print("é™å²¡")`` ã®ASTã‚’èª­ã‚€
--------------------------------------------------

.. literalinclude:: print-shizuoka-ast
    :emphasize-lines: 1

.. _ast.Module: https://docs.python.org/ja/3/library/ast.html#ast.Module

`ast.Module`_
--------------------------------------------------

* Pythonã¯æ–‡ãŒã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª [#python-statements]_
* ``body`` ã«ã¯ `æ–‡ <https://docs.python.org/ja/3/library/ast.html#ast-statements>`__ ãŒæ¥ã‚‹

    é–¢æ•°å‘¼ã³å‡ºã—ã®ã‚ˆã†ãªå¼ãŒãã‚Œè‡ªèº«ã§æ–‡ã¨ãªã‚Šã€ï¼ˆ`ast.Expr <https://docs.python.org/ja/3/library/ast.html#ast.Expr>`__ï¼‰

.. [#python-statements] `å˜ç´”æ–‡ <https://docs.python.org/ja/3/reference/simple_stmts.html>`__ãƒ»`è¤‡åˆæ–‡ <https://docs.python.org/ja/3/reference/compound_stmts.html>`__

ã©ã‚“ãªå¼ï¼ˆæ–‡ï¼‰ã‹
--------------------------------------------------

.. literalinclude:: print-shizuoka-ast
    :emphasize-lines: 4-7

.. _ast.Call: https://docs.python.org/ja/3/library/ast.html#ast.Call

`ast.Call`_ï¼šé–¢æ•°å‘¼ã³å‡ºã—
--------------------------------------------------

* ``func`` ã«çµ„ã¿è¾¼ã¿é–¢æ•°ã® ``print``
* ``args`` ã«ä½ç½®å¼•æ•°

.. literalinclude:: print-shizuoka-ast
    :lines: 4-7

.. https://docs.python.org/ja/3/library/ast.html#ast.Name
.. https://docs.python.org/ja/3/library/ast.html#ast.Constant

.. TODO å›³ï¼ˆDraw.ioã‚„Mermaidï¼‰ã‚’å…¥ã‚ŒãŸã„

æº–å‚™2ï¸âƒ£ Visitor ãƒ‘ã‚¿ãƒ¼ãƒ³
==================================================

* ã‚„ã‚ŠãŸã„ã“ã¨ï¼šæœ¨ã®ä¸­ã®ç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ãŸã„ï¼ˆä¾‹ï¼š``print`` é–¢æ•°ï¼‰
* æ“ä½œã‚’ **è¨ªå•è€…** ï¼ˆVisitorï¼‰ã«æ›¸ãã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯è¨ªå•è€…ã‚’å—ã‘å…¥ã‚Œã‚‹ [#gof-visitor-pattern]_

.. [#gof-visitor-pattern] ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«æ“ä½œã‚’æ›¸ãã®ã¨æ¯”ã¹ã¦ã€æ“ä½œã‚’è¿½åŠ ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚æ‹™ãƒ–ãƒ­ã‚° `èª­æ›¸&å†™çµŒãƒ­ã‚° | #ã¡ã‚‡ã†ãœã¤æœ¬ ç¬¬8ç«  Visitorãƒ‘ã‚¿ãƒ¼ãƒ³ <https://nikkie-ftnext.hatenablog.com/entry/the-transcendent-book-chapter8-design-patterns-visitor>`__

.. ã€ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆPythonãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ã«è©³ã—ã„ã‚‰ã—ã„

.. _ast.NodeVisitor: https://docs.python.org/ja/3/library/ast.html#ast.NodeVisitor

`ast.NodeVisitor`_
--------------------------------------------------

    æŠ½è±¡æ§‹æ–‡æœ¨ã‚’æ¸¡ã‚Šæ­©ã„ã¦ãƒ“ã‚¸ã‚¿ãƒ¼é–¢æ•°ã‚’è¦‹ã¤ã‘ãŸãƒãƒ¼ãƒ‰ã”ã¨ã«å‘¼ã³å‡ºã™ãƒãƒ¼ãƒ‰ãƒ»ãƒ“ã‚¸ã‚¿ãƒ¼ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

**ç¶™æ‰¿** ã—ãŸã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹

ä¾‹ï¼š``print`` ã‚’è¦‹ã¤ã‘ã‚‹
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/print_finder.py
    :language: python
    :pyobject: PrintFinder

å®Ÿè¡Œçµæœ
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/print_finder.py
    :language: python
    :lines: 12-17,19

.. code-block:: txt

    Found print at line 1, args ['é™å²¡']
    Found print at line 3, args ['æœ€é«˜']

``PrintFinder.visit()``
--------------------------------------------------

* è¦ªã‚¯ãƒ©ã‚¹ ``NodeVisitor`` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹
* ``visit`` ã¯ **ãƒãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹åã‹ã‚‰ visit_ã‚¯ãƒ©ã‚¹å ãƒ¡ã‚½ãƒƒãƒ‰** ã‚’å‘¼ã³å‡ºã™
* https://docs.python.org/ja/3/library/ast.html#ast.NodeVisitor.visit

``NodeVisitor.visit()`` ğŸƒâ€â™‚ï¸
--------------------------------------------------

.. code-block:: python

    class NodeVisitor(object):
        def visit(self, node):
            method = 'visit_' + node.__class__.__name__
            visitor = getattr(self, method, self.generic_visit)
            return visitor(node)

https://github.com/python/cpython/blob/v3.14.3/Lib/ast.py#L482-L516

visitã®ã‚¤ãƒ¡ãƒ¼ã‚¸
--------------------------------------------------

.. image:: ../_static/pyconshizu/visit-print-call.drawio.png
    :scale: 150%

é–¢æ•°å‘¼ã³å‡ºã—ãƒãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ **visit_Callã‚’è¿½åŠ **
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/print_finder.py
    :language: python
    :pyobject: PrintFinder
    :emphasize-lines: 3

.. literalinclude:: print-shizuoka-ast
    :emphasize-lines: 4-7

å†å¸°çš„ã«visit
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/print_finder.py
    :language: python
    :pyobject: PrintFinder
    :emphasize-lines: 6

* ``generic_visit``ï¼šå­ãƒãƒ¼ãƒ‰ã® ``visit`` ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—

ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæº–å‚™ã€OKï¼Ÿ
==================================================

:æŠ½è±¡æ§‹æ–‡æœ¨: ``ast`` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ç¢ºèªã§ãã‚‹
:Visitorãƒ‘ã‚¿ãƒ¼ãƒ³: ``ast.NodeVisitor`` ã‚’ç¶™æ‰¿ã€‚``visit_ãƒãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹å`` ã‚’å®Ÿè£…

ASTã®ãƒãƒ¼ãƒ‰ã‚’å·¡å›ã—ã¦ã€**ç‰¹å®šã®æ¡ä»¶ã®ãƒãƒ¼ãƒ‰** ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã™ï¼

ã€Œå¼•æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚’listã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ã‚’æ›¸ã
==================================================

.. literalinclude:: ../../samplecode/write-python-linter-rules/kotoha.py
    :language: python
    :pyobject: ArgumentListTypeHintChecker

é–¢æ•°å®šç¾©ã®ASTï¼ˆæŠœç²‹ï¼‰
--------------------------------------------------

.. literalinclude:: list-annotation-ast

.. python -m ast use_iterable.py

.. _ast.FunctionDef: https://docs.python.org/ja/3/library/ast.html#ast.FunctionDef

`ast.FunctionDef`_
--------------------------------------------------

* ``ast.arguments`` ãŒé–¢æ•°ã®å¼•æ•°å…¨ä½“
* **1ã¤1ã¤ã®å¼•æ•°** ãŒ `ast.arg <https://docs.python.org/ja/3/library/ast.html#ast.arg>`__

    * ``annotation`` ã«å‹ãƒ’ãƒ³ãƒˆ

``ast.arg`` ã® ``annotation``
--------------------------------------------------

.. literalinclude:: list-annotation-ast
    :emphasize-lines: 7

* **ast.Subscript**: ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ï¼ˆ ``def func(d: list[int])`` ï¼‰

å®Ÿè¡ŒçµæœğŸ™Œ
--------------------------------------------------

.. code-block:: python

    def plus_one_ng(numbers: list[int]) -> list[int]:
        return [n + 1 for n in numbers]

    def plus_one_ok(numbers: Iterable[int]) -> list[int]:
        return [n + 1 for n in numbers]

.. code-block:: txt

    Fix type hint `numbers: list[int]` at 1:16

``annotation`` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ ğŸƒâ€â™‚ï¸
--------------------------------------------------

* ``None``: å‹ãƒ’ãƒ³ãƒˆãªã—ï¼ˆ ``def func(a)`` ï¼‰
* ``ast.Name``: å˜ç´”ãªå‹ï¼ˆ ``def func(b: int)`` ï¼‰
* ``ast.Attribute``: ä¿®é£¾åï¼ˆ ``def func(tree: ast.AST)`` ï¼‰

å°ã¾ã¨ã‚ğŸ¥Ÿ ãƒªãƒ³ã‚¿ã®ãƒ«ãƒ¼ãƒ«ã‚’Pythonã§æ›¸ã
--------------------------------------------------

* ASTã¨Visitorãƒ‘ã‚¿ãƒ¼ãƒ³
* ``ast.NodeVisitor`` ã‚’ç¶™æ‰¿ã—ã¦ **visit_ãƒãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹å** ã‚’å®Ÿè£…
* ã€Œå¼•æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚’listã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ãƒ«ãƒ¼ãƒ«ã‚’Pythonã§å®Ÿè£…ã§ããŸ

flake8ã«ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹
==================================================

* Pythonè£½ãƒªãƒ³ã‚¿ https://github.com/PyCQA/flake8

1. å…ˆã®å®Ÿè£…ã‚’flake8ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«åˆã‚ã›ã‚‹ã ã‘
2. Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ã

.. https://flake8.pycqa.org/en/latest/plugin-development/index.html

(1)flake8ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
--------------------------------------------------

* ASTå‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼šflake8ãŒãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ã® ``ast.AST`` ã‚’æ¸¡ã—ã¦ãã‚Œã‚‹
* ``__init__(self, tree: ast.AST)``: ASTã‚’å—ã‘å–ã‚‹

.. literalinclude:: ../../samplecode/write-python-linter-rules/flake8_plugin_example/kotoha_plugin.py
    :lines: 20-22

.. revealjs-break::

* ``run()`` ãƒ¡ã‚½ãƒƒãƒ‰: 4-tuple ``(è¡Œç•ªå·, åˆ—ç•ªå·, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸, å‹)`` ã‚’ ``yield``
* ãƒã‚§ãƒƒã‚«ãƒ¼ã¯ ``print`` ã™ã‚‹ä»£ã‚ã‚Šã« ``self.errors`` ãƒªã‚¹ãƒˆã¸ã®è“„ç©ã«å¤‰æ›´

.. literalinclude:: ../../samplecode/write-python-linter-rules/flake8_plugin_example/kotoha_plugin.py
    :lines: 20,24-29

.. https://github.com/ftnext/kotoha-python-linter/blob/v0.1.1/src/kotoha/plugins.py

(2)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãæ–¹ï¼‰
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/flake8_plugin_example/pyproject.toml
    :lines: 5,8-11

.. https://github.com/ftnext/kotoha-python-linter/blob/v0.1.1/pyproject.toml

pylint ã§ã‚‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦æ›¸ã‘ã‚‹ ğŸƒâ€â™‚ï¸
--------------------------------------------------

* https://github.com/pylint-dev/pylint
* æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªastã§ãªã **astroid** ã‚’ä½¿ã£ã¦ AST ã‚’è¡¨ç¾ [#pylint-kotoha]_

.. code-block:: console

    $ pylint --load_plugins kotoha_plugin use_iterable.py

.. [#pylint-kotoha] æ‹™ãƒ–ãƒ­ã‚° `pylint ã‚’ä½¿ã£ãŸç´è‘‰ã¡ã‚ƒã‚“ã€Œå¼•æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚’ list ã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€ <https://nikkie-ftnext.hatenablog.com/entry/flake8-kotoha-experiment-pylint-checker-implementation>`__

.. flake8ã¸ã®printé–¢æ•°ã®å‘¼ã³å‡ºã—ã®æŒ‡æ‘˜ã¯ç·´ç¿’å•é¡Œã¨ã—ã¦ï¼Ÿ

.. _ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„è‡ªå‹•åŒ– Pylintã®ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ã†: https://2022.pycon.jp/timetable/?id=CNFPPT

ãŠã™ã™ã‚ï¼š`ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„è‡ªå‹•åŒ– Pylintã®ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ã†`_ ğŸƒâ€â™‚ï¸
--------------------------------------------------------------------------------

.. raw:: html

    <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/dd2b52803bf14bd7a5d1b0cb67315cfb" title="PyCon JP 2022/ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„è‡ªå‹•åŒ– Pylintã®ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ã†ã€" allowfullscreen="true" data-ratio="1.7777777777777777"></iframe>
Rustè£½ãƒªãƒ³ã‚¿ã«ãƒ«ãƒ¼ãƒ«ã‚’ã©ã†è¿½åŠ ã™ã‚‹ã‹
==================================================

Pythonã§ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‚ã®ã®...

Ruffï¼ˆå›³ã¯READMEã‚ˆã‚Šï¼‰
--------------------------------------------------

* https://github.com/astral-sh/ruff

    An extremely fast Python linter and code formatter, written in Rust.

.. image:: https://user-images.githubusercontent.com/1309177/232603514-c95e9b0f-6b31-43de-9a80-9e844173fd6a.svg

.. Ruffã® `README <https://github.com/astral-sh/ruff/blob/main/README.md>`__ ã®å›³ (ç™ºè¡¨æ™‚ 0.15.2)

.. ãƒã‚¤ãƒŠãƒª vs ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ï¼šã“ã®é•ã„ãŒé€Ÿã•ã®ä¸€å› 

Astralã€ŒRuff ã ã‘ã‚ã‚Œã°ã„ã„ã§ã—ã‚‡ã€
--------------------------------------------------

* æ•°ã€…ã®ãƒªãƒ³ã‚¿ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’Ruffã« **çµ±åˆ**

    Ruff can be used to replace Flake8 (plus dozens of plugins), Black, isort, pydocstyle, pyupgrade, autoflake, and more,

* ãƒ«ãƒ¼ãƒ«ã‚’å†å®Ÿè£…ã—ã€800è¶…ãˆã‚’ã‚«ãƒãƒ¼ [#ruff-rules-doc]_

.. [#ruff-rules-doc] ã€Œ*Ruff supports over 800 lint rules,*ã€ https://docs.astral.sh/ruff/rules/

ã‚³ãƒãƒ³ãƒ‰ä¾‹ [#ruff-command-article]_
--------------------------------------------------

.. code-block:: console

    uvx ruff format
    uvx ruff check --fix --extend-select I
    # ã¾ãŸã¯ uv format  # >= 0.8.13

æ˜¨æ—¥ã® `Ruff 0.15.2 <https://github.com/astral-sh/ruff/releases/tag/0.15.2>`__ ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«ãŒ **çˆ†å¢—** ã—ã¦ã¾ã™

.. https://github.com/astral-sh/uv/releases/tag/0.8.13

.. [#ruff-command-article] æ‹™ãƒ–ãƒ­ã‚° `Ruffã¯ format ã¨ check --fix ã®2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹ <https://nikkie-ftnext.hatenablog.com/entry/ruff-as-python-formatter-two-commands>`__

.. https://gihyo.jp/article/2023/03/monthly-python-2303

Ruffã«ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿæ§‹ãŒç„¡ã„ğŸˆšï¸
--------------------------------------------------

* ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ ã¯ã€æœ¬å®¶ã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¡ˆå†…ã•ã‚Œã‚‹ï¼ˆ`CONTRIBUTING.md <https://github.com/astral-sh/ruff/blob/main/CONTRIBUTING.md>`__ï¼‰
* `Meta issue: plugin system #283 <https://github.com/astral-sh/ruff/issues/283>`__ (2023/09 2å¹´åŠä»¥ä¸Šã‚ªãƒ¼ãƒ—ãƒ³ã€‚*æ”¾ç½®*ï¼Ÿ)
* è‡ªåˆ†ã«å¿…è¦ãªãƒ«ãƒ¼ãƒ«ã‚’ **æ‰‹å…ƒã§Ruffã«è¿½åŠ ã§ããªã„** çŠ¶æ…‹

Why Astral?
--------------------------------------------------

* é«˜é€Ÿãƒ„ãƒ¼ãƒ«ã«æœ€å¤§ç´šã®æ„Ÿè¬ã‚’ç¤ºã—ã¤ã¤ã‚‚ã€ç‡ç›´ã«è¨€ã£ã¦å›°ã£ã¦ã¾ã™
* æ‹™ãƒ–ãƒ­ã‚° `Ruffã¯Flake8ã®å…¨ã¦ã®è¦ç´ ã‚’å«ã‚“ã§ã„ã‚‹ã€ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ <https://nikkie-ftnext.hatenablog.com/entry/is-ruff-superset-of-flake8-my-answer-is-no-202501>`__ â€• å¦ï¼ˆäº’æ›ã§ãªã„ï¼‰
* **é€Ÿã•ã‚’å„ªå…ˆã™ã‚‹ã¨ã€æ©Ÿèƒ½ã®è±Šã‹ã•ã‚’å¤±ã†** ï¼ˆRuffã‚„Astralã¯ã‚‚ã£ã¨ã†ã¾ãç«‹ã¡å›ã‚Œã‚‹ã¯ãšï¼‰

.. https://github.com/astral-sh/ruff/issues/283#issuecomment-2354996290

Ruff + ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« ã‚’ã©ã†å®Ÿç¾ã™ã‚‹ã‹ï¼Ÿ
--------------------------------------------------

* flake8ï¼ˆã‚„pylintï¼‰ã¨ã®ä½µç”¨ã¯ãªã„ã€‚ã›ã£ã‹ãã®é€Ÿã•ã‚’å¤±ã†
* **é«˜é€Ÿã•ã‚’æãªã‚ãšã«ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãæ–¹æ³•** ã‚’æ±‚ã‚ã¦ã¾ã™ï¼ˆã‚¢ã‚¤ãƒ‡ã‚¢å‹Ÿé›†ã€‚å»Šä¸‹å¸Œæœ›ï¼‰

IMOï¼šä»£æ›¿æ‰‹æ®µ
--------------------------------------------------

A. ast-grep: Rustè£½ãƒ„ãƒ¼ãƒ«ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ **YAML** ã§æ›¸ã
B. **Rust** ã§ç›´æ¥æ›¸ã„ã¦ã¿ã‚‹: RustPython/Parser

ğŸ…°ï¸ ast-grep
==================================================

* https://github.com/ast-grep/ast-grep

    ast-grep is an abstract syntax tree based tool to search code by pattern code.

* **ASTã§grep** ã§ãã‚‹ï¼

ä½¿ã„æ–¹ï¼ˆä¸€ä¾‹ï¼‰
--------------------------------------------------

.. code-block:: console

    $ uvx --from ast-grep-cli ast-grep scan --rule ast-grep-kotoha.yaml examples.py

https://pypi.org/project/ast-grep-cli/

YAMLã§ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/kotoha.yaml
   :language: yaml

ast-grepã«ãŠã‘ã‚‹AST
--------------------------------------------------

.. code-block:: python

    def plus_one_ng(numbers: list[str]) -> list[int]: pass

.. literalinclude:: ../../samplecode/write-python-linter-rules/lint-targets/tree-sitter-output
   :lines: 2-12

https://ast-grep.github.io/playground.html

``list[]`` ã¨ã„ã†å‹ãƒ’ãƒ³ãƒˆã«ãƒãƒƒãƒ
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/kotoha.yaml
   :language: yaml
   :lines: 3-6

.. image:: ../_static/pyconshizu/ast-grep-playground-list-type-hint.png

.. https://ast-grep.github.io/guide/rule-config.html

è¦ªãƒãƒ¼ãƒ‰ã®æŒ‡å®šã‚’è¿½åŠ 
--------------------------------------------------

typed_parameter ã®ç›´ä¸‹ã® type

.. literalinclude:: ../../samplecode/write-python-linter-rules/kotoha.yaml
   :language: yaml
   :lines: 3-8
   :emphasize-lines: 5-6

.. image:: ../_static/pyconshizu/ast-grep-playground-list-typed-parameter.png

ast-grepã¯å®Ÿã¯ **tree-sitter** ã«ã‚ˆã‚‹ ğŸƒâ€â™‚ï¸
--------------------------------------------------

    ast-grep's core is an algorithm to search and replace code based on abstract syntax tree produced by tree-sitter. 

* tree-sitter ã¯å¤šè¨€èªå¯¾å¿œ
* https://tree-sitter.github.io/tree-sitter/

tree-sitter ã‚¯ã‚¨ãƒªã®ä¾‹ [#tree-sitter-blog]_ ğŸƒâ€â™‚ï¸
------------------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/kotoha.scm
   :language: scheme

.. [#tree-sitter-blog] æ‹™ãƒ–ãƒ­ã‚° `tree-sitterã§ã€é–¢æ•°ã®å¼•æ•°ã‚’listã§å‹ãƒ’ãƒ³ãƒˆã—ã¦ã„ã‚‹Pythonã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ğŸ” <https://nikkie-ftnext.hatenablog.com/entry/tree-sitter-python-query-like-flake8-kotoha>`__

ğŸ…±ï¸ ç™ºå±•ï¼šRustã§æ›¸ã
==================================================

* ã“ã®éƒ¨åˆ†ã ã‘Rustã®çŸ¥è­˜ã‚’å‰æã«ã—ã¾ã™
* é›°å›²æ°—ã ã‘æ´ã‚“ã§ã„ãŸã ã‘ã‚Œã°ï¼

RustPython/Parser
--------------------------------------------------

* https://github.com/RustPython/Parser
* RustPythonãŒä½¿ã†Pythonãƒ‘ãƒ¼ã‚µï¼ˆRustè£½ï¼‰
* Ruffã‚‚ã‹ã¤ã¦ä½¿ã£ã¦ã„ãŸ [#ruff-040-blog]_

.. [#ruff-040-blog] https://astral.sh/blog/ruff-v0.4.0

Rustç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
--------------------------------------------------

* `rustup <https://rustup.rs/>`__ ã§Rustç’°å¢ƒã‚’å°å…¥
* :command:`cargo` ã§Rustã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†

    * Astralã¯Pythonã«ãŠã‘ã‚‹cargoã¨ã—ã¦uvã‚’ææ¡ˆã—ã¦ã„ã‚‹

Pythonã‚³ãƒ¼ãƒ‰ã‚’Rustã§ãƒ‘ãƒ¼ã‚¹
--------------------------------------------------

.. code-block:: rust

    use rustpython_parser::{Parse, ast};

    fn main() {
        let python_source = r#"
    def plus_one_ng(numbers: list[int]) -> list[int]:
        return [n + 1 for n in numbers]
    "#;
        let ast = ast::Suite::parse(python_source, "<embedded>");
        assert!(ast.is_ok());
        println!("{:#?}", ast.unwrap());
    }

RustPython/Parserã®AST
--------------------------------------------------

.. literalinclude:: ../../samplecode/write-python-linter-rules/lint-targets/rustpython-parser-output
   :lines: 3-49

rustpython-astã®visitor feature
--------------------------------------------------

.. code-block:: rust

    use rustpython_ast::{Arguments, Visitor};

    struct KotohaVisitor<'a> {
        source: &'a str,
    }

    impl Visitor for KotohaVisitor<'_> {
        fn visit_arguments(&mut self, node: Arguments) {
            // ã“ã“ã«å‡¦ç†ã‚’æ›¸ã
        }
    }

Pythonå®Ÿè£…ã¨åŒæ§˜ã®æŒ‡æ‘˜
--------------------------------------------------

.. code-block:: python

    def plus_one_ng(numbers: list[int]) -> list[int]:
        return [n + 1 for n in numbers]

    def plus_one_ok(numbers: Iterable[int]) -> list[int]:
        return [n + 1 for n in numbers]

.. code-block:: console

    $ cargo run -q
    Fix type hint `numbers: list[int]` at 2:17

å°ã¾ã¨ã‚ğŸ¥Ÿ Rustè£½ãƒªãƒ³ã‚¿ã«ãƒ«ãƒ¼ãƒ«ã‚’ã©ã†è¿½åŠ ã™ã‚‹ã‹
--------------------------------------------------

* ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒãªã„Ruffã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã¨ä¸€ç·’ã«å‹•ã‹ã—ãŸã„
* **ast-grep**ï¼šRustè£½ãƒ„ãƒ¼ãƒ«ã§ã€YAMLã§ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã
* RustPython/Parserã‚’ä½¿ã£ã¦ **Rustã‚‚æ›¸ã„ã¦ã¿ãŸ** ï¼ˆç”ŸæˆAIã‚µãƒãƒ¼ãƒˆï¼‰
ã¾ã¨ã‚ğŸŒ¯ Pythonã®ãƒªãƒ³ã‚¿ã®ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ã†
==================================================

* Pythonã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã®æŒ‡æ‘˜ã¯ãƒªãƒ³ã‚¿ã«ä»»ã›ã‚ˆã†
* è‡ªåˆ†ãŒæ¬²ã—ã„ãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¨ãã¯ **è‡ªåˆ†ã§æ›¸ã“ã†**

Pythonã§ãƒªãƒ³ã‚¿ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã
--------------------------------------------------

* æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªastã§æŠ½è±¡æ§‹æ–‡æœ¨ã‚’è¦‹ãªãŒã‚‰ **æŒ‡æ‘˜ã—ãŸã„Pythonãƒãƒ¼ãƒ‰ã®å‡¦ç†ã‚’visitorã«è¿½åŠ **
* æ—¢å­˜ã®ãƒªãƒ³ã‚¿ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã—ã¦ãƒ«ãƒ¼ãƒ«è¿½åŠ 
* ğŸ’¡ãƒ«ãƒ¼ãƒ«ãŒæ›¸ã‘ãŸã‚‰ã€CLIã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãªã©ã‚’è¶³ã—ã¦ã„ã‘ã°ãƒªãƒ³ã‚¿ãŒä½œã‚Œã‚‹ã˜ã‚ƒã‚“ï¼

Ruff + ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«
--------------------------------------------------

* ast-grepï¼ˆ**YAML** ã§ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãï¼‰
* ã“ã®æ©Ÿä¼šã«Rustã‚’æ›¸ã„ã¡ã‚ƒãŠã†ğŸŒŸ
* Astralã¯ã•ã™ãŒã«ãã‚ãã‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ğŸ™ï¼ˆç§ã‚‚æŒ‘ã¿ã¾ã™ï¼‰

ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
--------------------------------------------------

Happy Python Developmentâ™ª
