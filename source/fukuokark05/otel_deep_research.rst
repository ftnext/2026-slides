==================================================
deep research ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ OTel ã§è¦—ã
==================================================

:Event: ç¦å²¡Rubyistä¼šè­°05
:Presented: 2026/02/28 nikkie

ãŠå‰ã€èª°ã‚ˆï¼ˆPythonä½¿ã„ã®è‡ªå·±ç´¹ä»‹ï¼‰
==================================================

* æ±äº¬åœ¨ä½ã€‚æ©Ÿæ¢°å­¦ç¿’ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
* `Speeda AI Agent <https://jp.ub-speeda.com/news/speeda-promotion-gallery/>`__ é–‹ç™ºï¼ˆdeep research æ©Ÿèƒ½å«ã‚€ï¼‰ [#hiring]_

.. image:: ../_static/uzabase-white-logo.png

.. [#hiring] `We're hiring! <https://hrmos.co/pages/uzabase/jobs/1829077236709650481>`__

ã‚‚ã†å°‘ã—è‡ªå·±ç´¹ä»‹
--------------------------------------------------

* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰llm-deep-researchï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‰
* `Python Meetup Fukuoka <https://www.youtube.com/@lycorptech_jp/search?query=Python%20Meetup>`__ ãŒç†±ãã¦ğŸ”¥ãŸã³ãŸã³å‚åŠ 
* ä»Šå›ã®ç™ºè¡¨ã‚’æ©Ÿã«ã€Rubyã¯5å¹´ä»¥ä¸Šã¶ã‚Š

ã“ã®ä¸€å¹´ã€ä½•ã‚’ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ
==================================================

* ãƒ†ãƒ¼ãƒï¼š"æœ€è¿‘ã€ä½•ã—ã¦ã‚‹ï¼Ÿ"
* https://regional.rubykaigi.org/fukuoka05/

deep researchğŸ’«
==================================================

2025/02/02 OpenAI `Introducing deep research <https://openai.com/index/introducing-deep-research/>`__

.. æ—¥æœ¬èª https://openai.com/ja-JP/index/introducing-deep-research/

.. in-depth: å¾¹åº•çš„ãª

çš†ã•ã‚“ä½¿ã£ã¦ã¾ã™ã‹ï¼ŸğŸ™‹
--------------------------------------------------

* GPT (OpenAI)
* Geminiãƒ»Claudeãªã©ãªã© [#deep-research-services]_
* å…¬é–‹å®Ÿè£…ã‚’å‹•ã‹ã—ãŸ
* è‡ªä½œã—ã¦ã„ã‚‹

.. [#deep-research-services] Grokãƒ»Perplexity

.. ç¶²ç¾…ã™ã‚‹ã‚ˆã‚Šä»£è¡¨ä¾‹ã‚’1ã¤ãšã¤ç´¹ä»‹ã—ã¦ã¿ã‚‹

OpenAI deep research
--------------------------------------------------

.. image:: ../_static/fukuokark05/openai-deep-research-example.png

.. ã€‡ã€‡ã‚’èª¿ã¹ã¦ï¼šè¿½åŠ è³ªå•â†’äººé–“ãŒå›ç­”â†’Webæ¤œç´¢â†’è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ10ã€œ15åˆ†ï¼‰
    2026/02ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå…¥ã£ãŸ

.. revealjs-break::

* LLMãŒèª¿æŸ»ã‚’ **è¨ˆç”»** ã—ã¦Webï¼ˆã‚„æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ **èª¿æŸ»** ï¼ˆ`Deep research in ChatGPT <https://help.openai.com/en/articles/10500283-deep-research-in-chatgpt>`__ï¼‰
* ç§ã¯æŠ€è¡“çš„ãªèª¿æŸ»ã¯ã€Œdeep researchã§OKã˜ã‚ƒã‚“ã€ã¨ãªã£ãŸ
* OpenAIã¯ **å°‚ç”¨ãƒ¢ãƒ‡ãƒ«** ã§å®Ÿç¾ [#deep-research-model]_

.. https://help.openai.com/en/articles/10500283-deep-research-in-chatgpt

.. [#deep-research-model] ã€Œ*The deep research model is powered by an early version of OpenAI o3 that is optimized for web browsing.*ã€ `Deep Research System Card <https://openai.com/index/deep-research-system-card/>`__

LLMã«Webæ¤œç´¢ã•ã›ã¦å†ç¾ã•ã›ã‚ˆã†ï¼
--------------------------------------------------

* OpenAIã®ã‚ˆã†ã«å°‚ç”¨ãƒ¢ãƒ‡ãƒ«ã¯é–‹ç™ºã§ããšã¨ã‚‚
* LLMã¯ *é“å…·ãŒä½¿ãˆã‚‹* ï¼ˆtool use = function callingï¼‰

.. tool useã¯ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿç¾ã™ã‚‹è¦ç´ ã§ã‚‚ã‚ã‚‹

.. å°‚ç”¨ãƒ¢ãƒ‡ãƒ«ã‚’é–‹ç™ºã™ã‚‹è«–æ–‡ã‚‚ã‚ã‚‹ï¼ˆOpenAIã®ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã¯å°ã•ãªãƒ¢ãƒ‡ãƒ«ï¼‰

.. revealjs-break::
    :notitle:

.. raw:: html

    <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/f912a0d061334d5aaf2fbf09ace3888c?slide=11" title="AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã¯ï¼ˆUB Tech vol.21ï¼‰" allowfullscreen="true" data-ratio="1.7777777777777777"></iframe>

.. _Open-source DeepResearch: https://huggingface.co/blog/open-deep-research

`Open-source DeepResearch`_
==================================================

* OpenAIã®ç™ºè¡¨ã‚’å—ã‘ã¦ã€Hugging FaceãŒ24æ™‚é–“å†ç¾ãƒãƒ£ãƒ¬ãƒ³ã‚¸
* https://github.com/huggingface/smolagents/tree/main/examples/open_deep_research

    This agent achieves **55% pass@1** on the GAIA validation set, compared to **67%** for the original Deep Research.

.. LLMã«ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ¸¡ã—ãŸ

å…¬é–‹å®Ÿè£…ãŒæ¬¡ã€…ã«ç™»å ´
--------------------------------------------------

.. TODO

* ä¼æ¥­ï¼šLangChainãªã©
* ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

æœ¬æ°—ã§æ¢ã›ã°100ä»¥ä¸Šï¼Ÿ

ç§ã¯å·¥å¤«ã‚’çŸ¥ã‚ŠãŸã„
--------------------------------------------------

* è‡ªä½œã®å‚è€ƒã«ã™ã‚‹ãŸã‚ã«å…¬é–‹å®Ÿè£…ã‚’å‹•ã‹ã™
* ä½œè€…ã§ã¯ãªã„ã®ã§ã€å†…éƒ¨ã®å‹•ããŒæ‰‹ã«å–ã‚‹ã‚ˆã†ã«ã¯ã‚ã‹ã‚‰ãªã„ï¼ˆ**ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹**ï¼‰

.. ä»Šãªã‚‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«èª¿ã¹ã¦ã‚‚ã‚‰ã†é¸æŠè‚¢ã‚ã‚Š

LLMã¸ã®å…¥åŠ›ã‚’å…¨éƒ¨åˆ†ã‹ã‚ŠãŸã„ï¼ˆæŸç¸›ç³»ï¼‰
--------------------------------------------------

* LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«ãŠã‘ã‚‹ç§ã®ä¿¡å¿µ
* deep researchã‚’ä¾é ¼ã•ã‚ŒãŸ **LLMã®ã‚ˆã†ã«è€ƒãˆã‚‹** [#think-like-agents]_
* æ”¹å–„æ¡ˆã‚’å‡ºã—ã‚„ã™ã„ï¼ˆLLMã‚ˆã‚Šå‰ã¯æ•°å­¦ã®ç†è§£ãŒå¿…è¦ã ã£ãŸï¼‰

.. [#think-like-agents] ã€Œ*Think like your agents*ã€ Anthropic `How we built our multi-agent research system <https://www.anthropic.com/engineering/built-multi-agent-research-system>`__

**OpenTelemetry** (OTel) ã«ç›®ã‚’ã¤ã‘ãŸï¼
==================================================

* ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ­ã‚°ï¼‰ã‹ã‚‰ **å¯è¦³æ¸¬æ€§** ã‚’å¾—ã‚‹æ‰‹æ®µ

    * ã‚·ã‚¹ãƒ†ãƒ ã®å‡ºåŠ›ã‹ã‚‰å†…éƒ¨çŠ¶æ…‹ã‚’ç†è§£ã™ã‚‹

* ãƒ™ãƒ³ãƒ€ãƒ¼ã‚„ãƒ„ãƒ¼ãƒ«ã®ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ãªã—

.. https://opentelemetry.io/ja/docs/what-is-opentelemetry/

.. ä»Šæœˆã®SoftwareDesignã€Œå†è€ƒãƒ»ãƒ­ã‚°è¨­è¨ˆã€ã€ã‚ˆã„ã§ã™... https://x.com/gihyosd/status/2027337725746315549

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¼æ’­
--------------------------------------------------

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«IDã‚’ä»˜ä¸ã—ã¦åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹

https://opentelemetry.io/ja/docs/concepts/context-propagation/#traces

.. åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
    ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¼æ’­

Semantic conventions
--------------------------------------------------

* https://opentelemetry.io/docs/specs/semconv/
* LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¦ç´„ç­–å®šãŒç¾åœ¨é€²è¡Œç³»

    * https://opentelemetry.io/docs/specs/semconv/gen-ai/

ä¾‹ãˆã° Gemini
--------------------------------------------------

* Pythonã§ã¯ `google-genai <https://pypi.org/project/google-genai/>`__ SDK
* OTelãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ `opentelemetry-instrumentation-google-genai <https://pypi.org/project/opentelemetry-instrumentation-google-genai/>`__

.. TODO è¨ˆè£…ã¨ã„ã†è¨€è‘‰ã®å°å…¥

Geminiã‚’ä½¿ã£ãŸdeep researchã®è¨ˆè£…ã‚¤ãƒ¡ãƒ¼ã‚¸
--------------------------------------------------

.. code-block:: python

    import deep_research_lib
    from opentelemetry.instrumentation.google_genai import GoogleGenAiSdkInstrumentor

    GoogleGenAiSdkInstrumentor().instrument()
    result = deep_research_lib.Agent().run(query)

.. TODO Pythonå®Ÿè£…ã¸ã®ãƒªãƒ³ã‚¯

å›ç­”ï¼šã“ã®ä¸€å¹´ã€ä½•ã‚’ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ
==================================================

* deep researchã®å®Ÿè£…ã‚’è¦‹ã¤ã‘ã‚‹
* OpenTelemetryã‚’æœ‰åŠ¹ã«ã—ã¦å‹•ã‹ã™ï¼ˆé‘‘è³ï¼‰
* æ°—ã«ãªã‚‹ç®‡æ‰€ã®ã‚½ãƒ¼ã‚¹ã‚’èª­ã¿ç†è§£æ·±ã‚ã‚‹ï¼ˆè‡ªåˆ†ã®å®Ÿè£…ã«æ´»ã‹ã™ï¼‰

ã“ã‚Œã‚’Rubyã§ã‚„ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã™
==================================================

.. TODO Rubyå®Ÿè£…ã¸ã®ãƒªãƒ³ã‚¯

ä»Šå›ã®deep research
--------------------------------------------------

1. topic_generator
2. topic_researcher
3. research_synthesizer

Gemini APIã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«faraday
--------------------------------------------------

.. code-block:: ruby

    conn = Faraday.new(
      url: "https://generativelanguage.googleapis.com"
    )
    response = conn.post(
      "/v1beta/models/gemini-3-flash-preview:generateContent"
    ) do |req|
      req.headers["Content-type"] = "application/json"
      req.headers["x-goog-api-key"] = api_key
      req.body = {
        contents: [
          {
            parts: [
              { text: "What's a good name for a flower shop that specializes in selling bouquets of dried flowers?" }
            ]
          }
        ]
      }.to_json
    end

opentelemetry-instrumentation-faraday
--------------------------------------------------

.. code-block:: ruby

    ENV["OTEL_TRACES_EXPORTER"] = "console"
    OpenTelemetry::SDK.configure do |c|
      c.use 'OpenTelemetry::Instrumentation::Faraday'
    end

é™ç•Œï¼šGemini APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸æ˜
--------------------------------------------------

.. code-block:: ruby

    ENV["OTEL_TRACES_EXPORTER"] = "console"
    OpenTelemetry::SDK.configure do |c|
      c.use 'OpenTelemetry::Instrumentation::Faraday'
    end

    agent = ResearchAgent.new(api_key: api_key, config: config)
    result = agent.run(USER_QUERY)

Workaround: faradayã®Middleware
--------------------------------------------------

.. code-block:: ruby

  class OtelBodyCaptureMiddleware < Faraday::Middleware
    def call(env)

    end
  end

  agent = ResearchAgent.new(api_key: api_key, config: config) do |conn|
    attach_faraday_otel_middlewares(conn)
  end

æœ€å¾Œã«
==================================================

* Googleã¯interactions APIã¨ã—ã¦deep researchã‚’æä¾›ã—ã¦ã„ã¾ã™
* Claude Code SDKï¼ˆã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒãƒ¼ãƒã‚¹ï¼‰ã‚’ä½¿ã†

ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ
--------------------------------------------------

.. ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰tool use
